#!/bin/bash

download() {
    INSTALL_DIR="/home/$USER/opt/linux-os-updater/"
    mkdir -p $INSTALL_DIR
    curl -L -o "${INSTALL_DIR}/update-$distro" "https://raw.githubusercontent.com/CrypticVerse/linux-os-updater/refs/heads/master/os/update-$distro.py"
    curl -L -o "${INSTALL_DIR}/version_mapping.py" "https://raw.githubusercontent.com/CrypticVerse/linux-os-updater/refs/heads/master/os/version_mapping.py"
    chmod +x "${INSTALL_DIR}/update-$distro"
}

echo "Welcome to Linux OS Updater!"
sleep 2

echo "Setting up files..."

uppercase_distro=$(grep ^NAME= /etc/os-release | cut -d= -f2 | tr -d '"' | tr -d ' ')
distro=$(echo "$uppercase_distro" | tr '[:upper:]' '[:lower:]')

echo "copying update files..."
download

declare -A names=(
    ["manjaro"]="archlinux"
    ["opensuseleap"]="opensuse"
)

for key in "${!names[@]}"; do
    
    if [[ "$distro" == "${names[$key]}" ]]; then
        mv "/home/$USER/opt/linux-os-updater/update-$distro.py" "/home/$USER/opt/linux-os-updater/update-$key.py"
        break
    fi
done

echo -e "\n\n\n\n"

echo -e "\033[0;32mScript successfully updated! Restart the terminal for changes to take effect.\033[0m"
